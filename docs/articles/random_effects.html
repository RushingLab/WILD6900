<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to random effects and hierarchical models • WILD6900</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to random effects and hierarchical models">
<meta property="og:description" content="WILD6900">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WILD6900</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2021.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lecture0/Lecture0.html">Lecture 0: Introduction to WILD6900</a>
    </li>
    <li>
      <a href="../articles/Lecture1/Lecture1.html">Lecture 1: Introduction to statistical inference in ecology</a>
    </li>
    <li>
      <a href="../articles/Lecture2/Lecture2.html">Lecture 2: Probability refresher (or introduction)</a>
    </li>
    <li>
      <a href="../articles/Lecture3/Lecture3.html">Lecture 3: Principles of Bayesian inference</a>
    </li>
    <li>
      <a href="../articles/Lecture4/Lecture4.html">Lecture 4: More about prior distributions</a>
    </li>
    <li>
      <a href="../articles/Lecture5/Lecture5.html">Lecture 5: Implementing Bayesian models: Introduction to MCMC samplers</a>
    </li>
    <li>
      <a href="../articles/Lecture6/Lecture6.html">Lecture 6: Introduction of Bayesian analysis using JAGS</a>
    </li>
    <li>
      <a href="../articles/Lecture7/Lecture7.html">Lecture 7: Generalized linear model review</a>
    </li>
    <li>
      <a href="../articles/Lecture8/Lecture8.html">Lecture 8: Introduction to hierarchical models</a>
    </li>
    <li>
      <a href="../articles/Lecture9/Lecture9.html">Lecture 9: Introduction to state-space models</a>
    </li>
    <li>
      <a href="../articles/Lecture10/Lecture10.html">Lecture 10: Estimating abundance: N-mixture models</a>
    </li>
    <li>
      <a href="../articles/Lecture11/Lecture11.html">Lecture 11: Estimating abundance: Occupancy modeling</a>
    </li>
    <li>
      <a href="../articles/Lecture12/Lecture12.html">Lecture 12: Estimating abundance: Closed-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture13/Lecture13.html">Lecture 13: Estimating survival: Open-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture14/Lecture14.html">Lecture 14: Estimating abundance and survival: Open-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture15/Lecture15.html">Lecture 15: Multi-state models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/rmarkdown_intro.html">Introduction to R Markdown</a>
    </li>
    <li>
      <a href="../articles/priors.html">Creating prior distributions</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating regression data</a>
    </li>
    <li>
      <a href="../articles/metropolis.html">Metropolis sampler for linear regression model</a>
    </li>
    <li>
      <a href="../articles/poisson_glm.html">Poisson and binomial GLMs in JAGS</a>
    </li>
    <li>
      <a href="../articles/random_effects.html">Random effects ANCOVA in JAGS</a>
    </li>
    <li>
      <a href="../articles/state_space.html">Simple state-space models in JAGS</a>
    </li>
    <li>
      <a href="../articles/state_space2.html">Age-structured state-space models</a>
    </li>
    <li>
      <a href="../articles/n-mixture1.html">Introduction to N-mixture models</a>
    </li>
    <li>
      <a href="../articles/n-mixture2.html">Advanced N-mixture models: Zero-inflation and posterior predictive checks</a>
    </li>
    <li>
      <a href="../articles/multi_spp_occ.html">Estimating species richness using hierarchical occupancy models</a>
    </li>
    <li>
      <a href="../articles/cjs.html">Cormack-Jolly-Seber models</a>
    </li>
    <li>
      <a href="../articles/multi-state.html">Quantifying temporary emigration using multi-state models</a>
    </li>
    <li>
      <a href="../articles/multi-state2.html">Multi-state model for survival/transition probability of a perennial plant</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/homework.html">
    <span class="fas fa-pencil-square-o"></span>
     
    Assignments
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="random_effects_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to random effects and hierarchical models</h1>
                        <h4 class="author">WILD6900</h4>
            
            <h4 class="date">2021-01-05</h4>
      
      
      <div class="hidden name"><code>random_effects.Rmd</code></div>

    </div>

    
    
<p>In this activity, we will use the process of simulating data to understand what random effects are and how they are interpreted in hierarchical models.</p>
<hr>
<p><strong>Objectives</strong></p>
<ul>
<li><p>Simulate data sets with both fixed and random effect structure</p></li>
<li><p>Fit fixed and random effects models in JAGS</p></li>
</ul>
<hr>
<p>For this lab, let’s assume we’re interested in modeling the the body mass (g) of lizards as a function of body length (mm). We capture lizards on <span class="math inline">\(J\)</span> study plots and measure the mass and length of each individual.</p>
<div id="the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The model</h2>
<p>In this example, we have a single continuous predictor variable and <span class="math inline">\(J\)</span> levels of a factor. We’ll assume for now that the residual body mass of each individual is normally distributed after accounting for body length. This suggests that following model:</p>
<p><span class="math display">\[y_{ij} = \alpha_{[j]} + \beta \times x_i + \epsilon_i\]</span></p>
<p><span class="math display">\[\alpha_{[j]} \sim normal(\mu_{alpha}, \tau_{alpha})\]</span></p>
<p><span class="math display">\[\epsilon_i \sim normal(0, \tau)\]</span></p>
<p>First, set up the simulation parameters:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">20</span>               <span class="co"># Number of sites</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span>              <span class="co"># Number of observations</span>
<span class="va">Length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>    <span class="co"># Scaled body length</span>

<span class="co">## Randomly determine each individuals study plot</span>
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">plot</th>
<th align="right">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">11</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">12</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="left">13</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">14</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">15</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">16</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">18</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">19</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">20</td>
<td align="right">13</td>
</tr>
</tbody>
</table>
<p>Now, let’s set the parameters in the model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mu.alpha</span> <span class="op">&lt;-</span> <span class="fl">23</span>   <span class="co"># Overall mean body mass</span>
<span class="va">sigma.alpha</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># standard deviation of group-level means</span>
<span class="va">tau.alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">sigma.alpha</span><span class="op">^</span><span class="fl">2</span>

<span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu.alpha</span>, <span class="va">sigma.alpha</span><span class="op">)</span>

<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">6</span>     <span class="co"># Slope of body length on mass</span>
<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">3</span>    <span class="co"># Residual standard deviation</span>
<span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></code></pre></div>
<p>To create the linear predictor, we’ll use the <code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> function to create the model matrix corresponding to our model and then multiply it by our parameters:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Xmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op">+</span> <span class="va">Length</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">Xmat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">21</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;   as.factor(plot)1 as.factor(plot)2 as.factor(plot)3  Length</span>
<span class="co">#&gt; 1                0                0                0  2.3513</span>
<span class="co">#&gt; 2                0                0                0  0.9134</span>
<span class="co">#&gt; 3                0                0                0 -0.8348</span>
<span class="co">#&gt; 4                0                0                0  0.6705</span>
<span class="co">#&gt; 5                0                0                0 -0.3413</span></code></pre></div>
<p>Now use matrix multiplication to create the linear predictor:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linear.pred</span> <span class="op">&lt;-</span> <span class="va">Xmat</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">linear.pred</span><span class="op">)</span>
<span class="co">#&gt;    [,1]</span>
<span class="co">#&gt; 1 37.88</span>
<span class="co">#&gt; 2 27.42</span>
<span class="co">#&gt; 3 19.79</span>
<span class="co">#&gt; 4 30.21</span>
<span class="co">#&gt; 5 24.14</span>
<span class="co">#&gt; 6 26.67</span></code></pre></div>
<p>And finally generate the observations and combine the relevant vectors within a single data frame:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="va">linear.pred</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span>
<span class="va">mass_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>, length <span class="op">=</span> <span class="va">Length</span>, pred_length <span class="op">=</span> <span class="va">linear.pred</span>, mass <span class="op">=</span> <span class="va">mass</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">mass_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">mass</span>, color <span class="op">=</span> <span class="va">plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">alpha</span>, slope <span class="op">=</span> <span class="va">beta</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<p><img src="random_effects_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="fitting-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-model" class="anchor"></a>Fitting the model</h2>
<p>Now we’re ready to fit the model in JAGS. Code for this model can be accessed with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"jags/random_ancova.jags"</span>, package <span class="op">=</span> <span class="st">"WILD6900"</span><span class="op">)</span></code></pre></div>
<p>Next, prepare the data, initial values, and MCMC settings. Notice the need to generate <span class="math inline">\(J\)</span> starting values of <span class="math inline">\(\alpha\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jags_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mass_df</span><span class="op">$</span><span class="va">mass</span>, N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mass_df</span><span class="op">)</span>, 
                  J <span class="op">=</span> <span class="va">J</span>,
                  plot <span class="op">=</span> <span class="va">plot</span>,
                  x <span class="op">=</span> <span class="va">mass_df</span><span class="op">$</span><span class="va">length</span><span class="op">)</span>

<span class="va">jags_inits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mu.alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
                              sigma.alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
                              alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span>, <span class="co"># Notice we need J initial values </span>
                              beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
                              tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>

<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mu.alpha"</span>, <span class="st">"sigma.alpha"</span>, <span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"tau"</span>, <span class="st">"sigma"</span><span class="op">)</span>

<span class="va">re_fit</span> <span class="op">&lt;-</span> <span class="fu">jagsUI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jagsUI/man/jags.html">jags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">jags_data</span>, inits <span class="op">=</span> <span class="va">jags_inits</span>,
                    parameters.to.save <span class="op">=</span> <span class="va">params</span>, 
                    model.file <span class="op">=</span> <span class="va">model.file</span>,
                    n.chains <span class="op">=</span> <span class="fl">3</span>, n.iter <span class="op">=</span> <span class="fl">10000</span>, n.burnin <span class="op">=</span> <span class="fl">2500</span>, n.thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">re_fit</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
25%
</th>
<th style="text-align:right;">
50%
</th>
<th style="text-align:right;">
75%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
Rhat
</th>
<th style="text-align:right;">
n.eff
</th>
<th style="text-align:right;">
overlap0
</th>
<th style="text-align:right;">
f
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
mu.alpha
</td>
<td style="text-align:right;">
23.409
</td>
<td style="text-align:right;">
0.4215
</td>
<td style="text-align:right;">
22.546
</td>
<td style="text-align:right;">
23.140
</td>
<td style="text-align:right;">
23.418
</td>
<td style="text-align:right;">
23.687
</td>
<td style="text-align:right;">
24.221
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
7606
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sigma.alpha
</td>
<td style="text-align:right;">
1.498
</td>
<td style="text-align:right;">
0.3804
</td>
<td style="text-align:right;">
0.847
</td>
<td style="text-align:right;">
1.233
</td>
<td style="text-align:right;">
1.462
</td>
<td style="text-align:right;">
1.725
</td>
<td style="text-align:right;">
2.352
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
4049
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[1]
</td>
<td style="text-align:right;">
23.882
</td>
<td style="text-align:right;">
0.8994
</td>
<td style="text-align:right;">
22.131
</td>
<td style="text-align:right;">
23.281
</td>
<td style="text-align:right;">
23.869
</td>
<td style="text-align:right;">
24.477
</td>
<td style="text-align:right;">
25.683
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
3720
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[2]
</td>
<td style="text-align:right;">
25.174
</td>
<td style="text-align:right;">
0.9543
</td>
<td style="text-align:right;">
23.373
</td>
<td style="text-align:right;">
24.516
</td>
<td style="text-align:right;">
25.153
</td>
<td style="text-align:right;">
25.794
</td>
<td style="text-align:right;">
27.123
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
10289
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[3]
</td>
<td style="text-align:right;">
21.824
</td>
<td style="text-align:right;">
0.7743
</td>
<td style="text-align:right;">
20.273
</td>
<td style="text-align:right;">
21.309
</td>
<td style="text-align:right;">
21.833
</td>
<td style="text-align:right;">
22.355
</td>
<td style="text-align:right;">
23.322
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[4]
</td>
<td style="text-align:right;">
21.828
</td>
<td style="text-align:right;">
1.0506
</td>
<td style="text-align:right;">
19.717
</td>
<td style="text-align:right;">
21.123
</td>
<td style="text-align:right;">
21.859
</td>
<td style="text-align:right;">
22.562
</td>
<td style="text-align:right;">
23.784
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[5]
</td>
<td style="text-align:right;">
22.681
</td>
<td style="text-align:right;">
0.7331
</td>
<td style="text-align:right;">
21.235
</td>
<td style="text-align:right;">
22.191
</td>
<td style="text-align:right;">
22.683
</td>
<td style="text-align:right;">
23.183
</td>
<td style="text-align:right;">
24.098
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
13398
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[6]
</td>
<td style="text-align:right;">
22.921
</td>
<td style="text-align:right;">
0.9034
</td>
<td style="text-align:right;">
21.132
</td>
<td style="text-align:right;">
22.320
</td>
<td style="text-align:right;">
22.930
</td>
<td style="text-align:right;">
23.527
</td>
<td style="text-align:right;">
24.678
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[7]
</td>
<td style="text-align:right;">
24.221
</td>
<td style="text-align:right;">
0.8419
</td>
<td style="text-align:right;">
22.600
</td>
<td style="text-align:right;">
23.649
</td>
<td style="text-align:right;">
24.212
</td>
<td style="text-align:right;">
24.784
</td>
<td style="text-align:right;">
25.924
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[8]
</td>
<td style="text-align:right;">
22.890
</td>
<td style="text-align:right;">
1.1111
</td>
<td style="text-align:right;">
20.650
</td>
<td style="text-align:right;">
22.159
</td>
<td style="text-align:right;">
22.911
</td>
<td style="text-align:right;">
23.637
</td>
<td style="text-align:right;">
25.041
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
15306
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Just for kicks, let’s fit the same data to a model that assumes fixed-effects on the <span class="math inline">\(\alpha\)</span>’s:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"jags/fixed_ancova.jags"</span>, package <span class="op">=</span> <span class="st">"WILD6900"</span><span class="op">)</span>

<span class="va">jags_inits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span>, <span class="co"># Notice we need J initial values </span>
                              beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
                              tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>

<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"tau"</span>, <span class="st">"sigma"</span><span class="op">)</span>

<span class="va">fe_fit</span> <span class="op">&lt;-</span> <span class="fu">jagsUI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jagsUI/man/jags.html">jags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">jags_data</span>, inits <span class="op">=</span> <span class="va">jags_inits</span>,
                    parameters.to.save <span class="op">=</span> <span class="va">params</span>, 
                    model.file <span class="op">=</span> <span class="va">model.file</span>,
                    n.chains <span class="op">=</span> <span class="fl">3</span>, n.iter <span class="op">=</span> <span class="fl">10000</span>, n.burnin <span class="op">=</span> <span class="fl">2500</span>, n.thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fe_fit</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
25%
</th>
<th style="text-align:right;">
50%
</th>
<th style="text-align:right;">
75%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
Rhat
</th>
<th style="text-align:right;">
n.eff
</th>
<th style="text-align:right;">
overlap0
</th>
<th style="text-align:right;">
f
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
alpha[1]
</td>
<td style="text-align:right;">
23.89
</td>
<td style="text-align:right;">
1.1141
</td>
<td style="text-align:right;">
21.69
</td>
<td style="text-align:right;">
23.15
</td>
<td style="text-align:right;">
23.90
</td>
<td style="text-align:right;">
24.64
</td>
<td style="text-align:right;">
26.07
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7390
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[2]
</td>
<td style="text-align:right;">
25.95
</td>
<td style="text-align:right;">
1.1243
</td>
<td style="text-align:right;">
23.73
</td>
<td style="text-align:right;">
25.20
</td>
<td style="text-align:right;">
25.94
</td>
<td style="text-align:right;">
26.70
</td>
<td style="text-align:right;">
28.17
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
18945
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[3]
</td>
<td style="text-align:right;">
21.07
</td>
<td style="text-align:right;">
0.8502
</td>
<td style="text-align:right;">
19.39
</td>
<td style="text-align:right;">
20.50
</td>
<td style="text-align:right;">
21.07
</td>
<td style="text-align:right;">
21.64
</td>
<td style="text-align:right;">
22.71
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[4]
</td>
<td style="text-align:right;">
20.17
</td>
<td style="text-align:right;">
1.2946
</td>
<td style="text-align:right;">
17.62
</td>
<td style="text-align:right;">
19.30
</td>
<td style="text-align:right;">
20.18
</td>
<td style="text-align:right;">
21.04
</td>
<td style="text-align:right;">
22.71
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6441
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[5]
</td>
<td style="text-align:right;">
22.28
</td>
<td style="text-align:right;">
0.8333
</td>
<td style="text-align:right;">
20.63
</td>
<td style="text-align:right;">
21.72
</td>
<td style="text-align:right;">
22.28
</td>
<td style="text-align:right;">
22.85
</td>
<td style="text-align:right;">
23.92
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13812
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[6]
</td>
<td style="text-align:right;">
22.35
</td>
<td style="text-align:right;">
1.1203
</td>
<td style="text-align:right;">
20.16
</td>
<td style="text-align:right;">
21.60
</td>
<td style="text-align:right;">
22.35
</td>
<td style="text-align:right;">
23.12
</td>
<td style="text-align:right;">
24.52
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[7]
</td>
<td style="text-align:right;">
24.36
</td>
<td style="text-align:right;">
1.0073
</td>
<td style="text-align:right;">
22.36
</td>
<td style="text-align:right;">
23.68
</td>
<td style="text-align:right;">
24.35
</td>
<td style="text-align:right;">
25.03
</td>
<td style="text-align:right;">
26.34
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[8]
</td>
<td style="text-align:right;">
21.68
</td>
<td style="text-align:right;">
1.5775
</td>
<td style="text-align:right;">
18.61
</td>
<td style="text-align:right;">
20.62
</td>
<td style="text-align:right;">
21.67
</td>
<td style="text-align:right;">
22.75
</td>
<td style="text-align:right;">
24.77
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22500
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[9]
</td>
<td style="text-align:right;">
24.48
</td>
<td style="text-align:right;">
0.9201
</td>
<td style="text-align:right;">
22.67
</td>
<td style="text-align:right;">
23.85
</td>
<td style="text-align:right;">
24.47
</td>
<td style="text-align:right;">
25.10
</td>
<td style="text-align:right;">
26.28
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14495
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha[10]
</td>
<td style="text-align:right;">
21.74
</td>
<td style="text-align:right;">
1.4307
</td>
<td style="text-align:right;">
18.92
</td>
<td style="text-align:right;">
20.78
</td>
<td style="text-align:right;">
21.75
</td>
<td style="text-align:right;">
22.71
</td>
<td style="text-align:right;">
24.55
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21272
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Finally, combine results from the two models to visualize differences in the <span class="math inline">\(\alpha\)</span> estimates:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">compare_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>alpha_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">re_fit</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">alpha</span>, <span class="va">fe_fit</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span>,
                           CI_2.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">re_fit</span><span class="op">$</span><span class="va">q2.5</span><span class="op">$</span><span class="va">alpha</span>, <span class="va">fe_fit</span><span class="op">$</span><span class="va">q2.5</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span>,
                           CI_97.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">re_fit</span><span class="op">$</span><span class="va">q97.5</span><span class="op">$</span><span class="va">alpha</span>, <span class="va">fe_fit</span><span class="op">$</span><span class="va">q97.5</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span>, 
                           n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.15</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.15</span><span class="op">)</span>,
                           model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Random"</span>, <span class="st">"Fixed"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">J</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">compare_mods</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha_mean</span>, color <span class="op">=</span> <span class="va">model</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mu.alpha</span>, color <span class="op">=</span> <span class="st">"grey50"</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">re_fit</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">mu.alpha</span>, color <span class="op">=</span> <span class="st">"#CD0200"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">CI_2.5</span>, xmax <span class="op">=</span> <span class="va">CI_97.5</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#446E9B"</span>, <span class="st">"#D47500"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span></code></pre></div>
<p><img src="random_effects_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="quantifying-changes-in-coal-tit-periparus-ater-abundance" class="section level1">
<h1 class="hasAnchor">
<a href="#quantifying-changes-in-coal-tit-periparus-ater-abundance" class="anchor"></a>Quantifying changes in Coal tit (<em>Periparus ater</em>) abundance</h1>
<p>In the remainder of this lab, you will use data from the Swiss Breeding Bird Survey to model changes in the abundance of Swiss Coal tits from 1999-2007.</p>
<div class="figure" style="text-align: center">
<img src="https://upload.wikimedia.org/wikipedia/commons/b/b6/2017.01.27.-18-Paradiski-La_Plagne-Champagny-en-Vanoise--Tannenmeise.jpg" alt="Photo by Andreas Eichler via WikiCommons" width="100%"><p class="caption">
Photo by Andreas Eichler via WikiCommons
</p>
</div>
<p>A data frame containing the counts and some additional information about each site (elevation and percent forest cover) and count (observer ID and whether it was an observers first time doing a BBS survey) is included in the <code>WILD6900</code> package <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"tits"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tits</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;">
spec
</th>
<th style="text-align:right;">
elevation
</th>
<th style="text-align:right;">
forest
</th>
<th style="text-align:right;">
y1999
</th>
<th style="text-align:right;">
y2000
</th>
<th style="text-align:right;">
y2001
</th>
<th style="text-align:right;">
y2002
</th>
<th style="text-align:right;">
y2003
</th>
<th style="text-align:right;">
y2004
</th>
<th style="text-align:right;">
y2005
</th>
<th style="text-align:right;">
y2006
</th>
<th style="text-align:right;">
y2007
</th>
<th style="text-align:right;">
obs1999
</th>
<th style="text-align:right;">
obs2000
</th>
<th style="text-align:right;">
obs2001
</th>
<th style="text-align:right;">
obs2002
</th>
<th style="text-align:right;">
obs2003
</th>
<th style="text-align:right;">
obs2004
</th>
<th style="text-align:right;">
obs2005
</th>
<th style="text-align:right;">
obs2006
</th>
<th style="text-align:right;">
obs2007
</th>
<th style="text-align:right;">
first1999
</th>
<th style="text-align:right;">
first2000
</th>
<th style="text-align:right;">
first2001
</th>
<th style="text-align:right;">
first2002
</th>
<th style="text-align:right;">
first2003
</th>
<th style="text-align:right;">
first2004
</th>
<th style="text-align:right;">
first2005
</th>
<th style="text-align:right;">
first2006
</th>
<th style="text-align:right;">
first2007
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
186
</td>
<td style="text-align:left;">
Coaltit
</td>
<td style="text-align:right;">
420
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
2125
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
NA.29
</td>
<td style="text-align:left;">
Coaltit
</td>
<td style="text-align:right;">
450
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2.1
</td>
<td style="text-align:left;">
Coaltit
</td>
<td style="text-align:right;">
1050
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2064
</td>
<td style="text-align:right;">
2064
</td>
<td style="text-align:right;">
2064
</td>
<td style="text-align:right;">
3299
</td>
<td style="text-align:right;">
3299
</td>
<td style="text-align:right;">
3299
</td>
<td style="text-align:right;">
3299
</td>
<td style="text-align:right;">
3299
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
189.1
</td>
<td style="text-align:left;">
Coaltit
</td>
<td style="text-align:right;">
920
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1576
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
2031
</td>
<td style="text-align:right;">
169
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
191.1
</td>
<td style="text-align:left;">
Coaltit
</td>
<td style="text-align:right;">
1110
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
Coaltit
</td>
<td style="text-align:right;">
510
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2158
</td>
<td style="text-align:right;">
3288
</td>
<td style="text-align:right;">
3288
</td>
<td style="text-align:right;">
3304
</td>
<td style="text-align:right;">
3304
</td>
<td style="text-align:right;">
3304
</td>
<td style="text-align:right;">
3304
</td>
<td style="text-align:right;">
3304
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<div id="preparing-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-the-data" class="anchor"></a>Preparing the data</h2>
<p>Before running any models, we will first prepare the data. JAGS will take the counts and predictor variables as matrices with dimensions of <code>nSites x nYears</code>. Those matrices can easily be created from the data frame:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tits</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span><span class="op">)</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tits</span><span class="op">[</span><span class="fl">14</span><span class="op">:</span><span class="fl">22</span><span class="op">]</span><span class="op">)</span>
<span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tits</span><span class="op">[</span><span class="fl">23</span><span class="op">:</span><span class="fl">31</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="fl">1999</span><span class="op">:</span><span class="fl">2007</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1</span>, ylab <span class="op">=</span> <span class="st">"Territory counts"</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="random_effects_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<p>One issue with the <code>obs</code> and <code>first</code> matrices is that they contain <code>NA</code> values, which JAGS will not allow in predictor variables (they are ok in the response variable, as we will soon see). Some of the <code>NA</code> values correspond to years when a sites was not surveyed (in these cases, there will also be a <code>NA</code> in the <code>C</code> matrix). In addition, JAGS will want the observer ID as a continuous variable rather than a factor. We will first convert the <code>obs</code> levels into a numeric vector and the create a new matrix containing the correct numeric IDs:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>     <span class="co"># All the levels, numeric</span>
<span class="va">newobs</span> <span class="op">&lt;-</span> <span class="va">obs</span>                            <span class="co"># Gets ObsID from 1:271</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">newobs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">obs</span><span class="op">==</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">}</span></code></pre></div>
<p>Next, we need to fill in the <code>NA</code> values. For the observer ID, we’ll lump all missing values as a single value corresponding to the number of observers + 1. For the <code>first</code> matrix, we will code the <code>NA</code> values as <code>0</code>, which corresponds to an ‘experienced’ observer. This will decrease our power to quantify the effect of being a novice observer but not to the extent that it will substantially alter our conclusions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newobs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">newobs</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">first</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">first</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></code></pre></div>
</div>
<div id="the-simplest-count-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-simplest-count-model" class="anchor"></a>The simplest count model</h2>
<p>Let’s start by fitting the most simple model we can create for these data: the intercept-only model. In this model, we assume that the expected number of coal tits is constant, that is, it doesn’t vary across sites or years or observers.</p>
<hr>
<p><strong>On your own</strong>, write out the distribution, link function, and linear predictor for the intercept-only model. What parameters does this model include? What prior distribution(s) would be most appropriate for these parameters?</p>
<hr>
<p>You can view the JAGS code for this model by running:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm0_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"jags/GLM0.jags"</span>, package <span class="op">=</span> <span class="st">"WILD6900"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/file.show.html">file.show</a></span><span class="op">(</span><span class="va">glm0_mod</span><span class="op">)</span></code></pre></div>
<p>Now prepare the data and MCMC settings to run this model:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bundle data</span>
<span class="va">glm0_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span>, nsite <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span>, nyear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Initial values</span>
<span class="va">glm0_inits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Parameters monitored</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span><span class="op">)</span>

<span class="co"># MCMC settings</span>
<span class="va">ni</span> <span class="op">&lt;-</span> <span class="fl">1200</span>
<span class="va">nt</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">nb</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fl">3</span>

<span class="co"># Call JAGS from R</span>
<span class="va">glm0</span> <span class="op">&lt;-</span> <span class="fu">jagsUI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jagsUI/man/jags.html">jags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">glm0_data</span>, inits <span class="op">=</span>  <span class="va">glm0_inits</span>,
                     parameters.to.save <span class="op">=</span> <span class="va">params</span>, 
                     model.file <span class="op">=</span> <span class="va">glm0_mod</span>, n.chains <span class="op">=</span> <span class="va">nc</span>, 
                     n.thin <span class="op">=</span> <span class="va">nt</span>, n.iter <span class="op">=</span> <span class="va">ni</span>, n.burnin <span class="op">=</span> <span class="va">nb</span><span class="op">)</span>

<span class="co"># Summarize posteriors</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">glm0</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="co"># Check trace plots</span>
<span class="fu">jagsUI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jagsUI/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">glm0</span><span class="op">)</span></code></pre></div>
</div>
<div id="fixed-site-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#fixed-site-effects" class="anchor"></a>Fixed site effects</h2>
<p>The intercept-only model is obviously not a very good model of these counts but serves as a useful starting point for developing more complex models. As a start for building a better model, let’s add site as a fixed effect. In other words:</p>
<p><span class="math display">\[y_{ij} \sim Poisson(\lambda_j)\]</span> <span class="math display">\[log(\lambda_j) = \alpha_j\]</span></p>
<p>Modify the JAGS model from the previous example to run this fixed-site model. As a starting point:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="st">"jags/GLM0.jags"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"
    model {

    # Prior
    alpha ~ dnorm(0, 0.01)    # log(mean count)

    # Likelihood
    for (i in 1:nyear){
    for (j in 1:nsite){
    C[i,j] ~ dpois(lambda[i,j])
    lambda[i,j] &lt;- exp(log.lambda[i,j])
    log.lambda[i,j] &lt;- alpha
    }  #j
    }  #i
    }
    "</span>,fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="op">)</span>
    </code></pre></div>
<p>Be sure to change the name of the model file before running that code. Now modify the data and inits object as necessary to run the model in JAGS. Also note that in the <code><a href="https://rdrr.io/pkg/jagsUI/man/jags.html">jagsUI::jags()</a></code> call you will need to reference the model file you just created rather than the model file from the previous example.</p>
</div>
<div id="additional-complexity" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-complexity" class="anchor"></a>Additional complexity</h2>
<p>Even with this relatively simple data set, you can create relatively complex models. On your own, try to fit the following models using the JAGS code from above as a starting point:</p>
<ul>
<li><p>Fixed year and site effects</p></li>
<li><p>Random site effects</p></li>
<li><p>Random year effects</p></li>
<li><p>Random site and random year effects</p></li>
<li><p>Random site and random year effects and fixed first-year observer effect</p></li>
<li><p>Random site and random year effects, linear year effect and fixed first-year observer effect</p></li>
</ul>
<p>One note about including multiple factors in the model. In the models with both site and year (as a factor), the model cannot estimate the predicted count for all combinations of both factors. Essentially, the model needs to set one level of one of the factors to a “reference” level to avoid over-parameterization. In JAGS, we have to do this manually by setting the prior for one level to zero:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eps</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></code></pre></div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Data and code from Kéry &amp; Schaub 2015. <em>Bayesian Population Analysis using WinBugs</em><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
