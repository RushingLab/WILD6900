<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating species richness using hierarchical occupancy models • WILD6900</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating species richness using hierarchical occupancy models">
<meta property="og:description" content="WILD6900">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WILD6900</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2021.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lecture0/Lecture0.html">Lecture 0: Introduction to WILD6900</a>
    </li>
    <li>
      <a href="../articles/Lecture1/Lecture1.html">Lecture 1: Introduction to statistical inference in ecology</a>
    </li>
    <li>
      <a href="../articles/Lecture2/Lecture2.html">Lecture 2: Probability refresher (or introduction)</a>
    </li>
    <li>
      <a href="../articles/Lecture3/Lecture3.html">Lecture 3: Principles of Bayesian inference</a>
    </li>
    <li>
      <a href="../articles/Lecture4/Lecture4.html">Lecture 4: More about prior distributions</a>
    </li>
    <li>
      <a href="../articles/Lecture5/Lecture5.html">Lecture 5: Implementing Bayesian models: Introduction to MCMC samplers</a>
    </li>
    <li>
      <a href="../articles/Lecture6/Lecture6.html">Lecture 6: Introduction of Bayesian analysis using JAGS</a>
    </li>
    <li>
      <a href="../articles/Lecture7/Lecture7.html">Lecture 7: Generalized linear model review</a>
    </li>
    <li>
      <a href="../articles/Lecture8/Lecture8.html">Lecture 8: Introduction to hierarchical models</a>
    </li>
    <li>
      <a href="../articles/Lecture9/Lecture9.html">Lecture 9: Introduction to state-space models</a>
    </li>
    <li>
      <a href="../articles/Lecture10/Lecture10.html">Lecture 10: Estimating abundance: N-mixture models</a>
    </li>
    <li>
      <a href="../articles/Lecture11/Lecture11.html">Lecture 11: Estimating abundance: Occupancy modeling</a>
    </li>
    <li>
      <a href="../articles/Lecture12/Lecture12.html">Lecture 12: Estimating abundance: Closed-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture13/Lecture13.html">Lecture 13: Estimating survival: Open-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture14/Lecture14.html">Lecture 14: Estimating abundance and survival: Open-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture15/Lecture15.html">Lecture 15: Multi-state models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/rmarkdown_intro.html">Introduction to R Markdown</a>
    </li>
    <li>
      <a href="../articles/priors.html">Creating prior distributions</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating regression data</a>
    </li>
    <li>
      <a href="../articles/metropolis.html">Metropolis sampler for linear regression model</a>
    </li>
    <li>
      <a href="../articles/poisson_glm.html">Poisson and binomial GLMs in JAGS</a>
    </li>
    <li>
      <a href="../articles/random_effects.html">Random effects ANCOVA in JAGS</a>
    </li>
    <li>
      <a href="../articles/state_space.html">Simple state-space models in JAGS</a>
    </li>
    <li>
      <a href="../articles/state_space2.html">Age-structured state-space models</a>
    </li>
    <li>
      <a href="../articles/n-mixture1.html">Introduction to N-mixture models</a>
    </li>
    <li>
      <a href="../articles/n-mixture2.html">Advanced N-mixture models: Zero-inflation and posterior predictive checks</a>
    </li>
    <li>
      <a href="../articles/multi_spp_occ.html">Estimating species richness using hierarchical occupancy models</a>
    </li>
    <li>
      <a href="../articles/cjs.html">Cormack-Jolly-Seber models</a>
    </li>
    <li>
      <a href="../articles/multi-state.html">Quantifying temporary emigration using multi-state models</a>
    </li>
    <li>
      <a href="../articles/multi-state2.html">Multi-state model for survival/transition probability of a perennial plant</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/homework.html">
    <span class="fas fa-pencil-square-o"></span>
     
    Assignments
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multi_spp_occ_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating species richness using hierarchical occupancy models</h1>
                        <h4 class="author">WILD6900</h4>
            
            <h4 class="date">2021-01-05</h4>
      
      
      <div class="hidden name"><code>multi_spp_occ.Rmd</code></div>

    </div>

    
    
<p>An important goal of many ecological studies is estimating the richness (i.e., the number of species) of a particular site or region. One of the primary challenges of estimating richness is that some species will not be detected during the surveys. As a result, we will often underestimate richness if we take it to be the number of observed species.</p>
<p>In this lab, we will continue to explore fitting site-occupancy models in JAGS by developing a multi-species model that accounts for imperfect detection. This model treats both occupancy probability <span class="math inline">\(\psi\)</span> and detection probability <span class="math inline">\(p\)</span> as species-level random effects. The benefit of the hierarchical structure is that, by using data augmentation, we can estimate <span class="math inline">\(\psi\)</span> and <span class="math inline">\(p\)</span> of species that were not detected and therefore obtain estimates of richness that correct for imperfect detection! Confused? That’s ok. Hopefully simulating data and writing the model will help.</p>
<div id="simulating-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-the-data" class="anchor"></a>Simulating the data</h2>
<p>As in all site-occupancy models, we imagine conducting <code>K</code> replicate surveys at <code>J</code> sites. In the multi-species model, we also need to set the true species richness <code>R</code>. For this example, we’ll assume:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Number of species (richness)</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">120</span>

<span class="co">## Number of sites surveyed </span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">15</span>

<span class="co">## Number of visits per site</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">3</span></code></pre></div>
<p>Next, we will simulate the species-specific occupancy and detection probabilities. We will do this in a hierarchical way: first set the overall mean occupancy probability for the entire community and the variance among species. Then generate the species-specific value from this distribution. Many communities are dominated by lots of rare and elusive species, with a few common species. As such, we’ll set the mean occupancy probability to a low values but allow for some high values:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mean occupancy probability</span>
<span class="va">mu.psi</span> <span class="op">&lt;-</span> <span class="fl">0.6</span>

<span class="co">## Covert to logit-scale</span>
<span class="va">lmu.psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">mu.psi</span><span class="op">)</span>

<span class="co">## Occupancy sd (and precision)</span>
<span class="va">sd.psi</span> <span class="op">&lt;-</span> <span class="fl">1.25</span>
<span class="va">tau.psi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">sd.psi</span><span class="op">^</span><span class="fl">2</span>

<span class="co">## Species-specific occupancy probability</span>
<span class="va">lpsi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">R</span>, mean <span class="op">=</span> <span class="va">lmu.psi</span>, sd <span class="op">=</span> <span class="va">sd.psi</span><span class="op">)</span>
<span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">lpsi</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">psi</span><span class="op">)</span></code></pre></div>
<p><img src="multi_spp_occ_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>Now the detection probabilities:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mean detection probability</span>
<span class="va">mu.p</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>

<span class="co">## Covert to logit-scale</span>
<span class="va">lmu.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">mu.p</span><span class="op">)</span>

<span class="co">## Detection sd (and precision)</span>
<span class="va">sd.p</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">tau.p</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">sd.p</span><span class="op">^</span><span class="fl">2</span>

<span class="co">## Species-specific detection probability</span>
<span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">R</span>, mean <span class="op">=</span> <span class="va">lmu.p</span>, sd <span class="op">=</span> <span class="va">sd.p</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<p><img src="multi_spp_occ_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>Next, we simulate the true occupancy status of each species at each site. First create an empty <span class="math inline">\(R \times J\)</span> matrix, then fill in the site-specific occupancy for each species using the <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> function and the species-specific occupancy probabilities:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## True occupancy at each sites</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">R</span>, ncol <span class="op">=</span> <span class="va">J</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span><span class="op">{</span>
  <span class="va">z</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">J</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">psi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Finally, we simulate the observations. Last week, we treated each occasion <span class="math inline">\(K\)</span> as a separate Bernoulli trial. In the case, we’ll use a different formulation by noting that the number of successes out of <span class="math inline">\(K\)</span> Bernoulli trials (all with the same <span class="math inline">\(p\)</span>) can also be modeled using a binomial model with size <span class="math inline">\(K\)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Observed occupancy at each sites</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">R</span>, ncol <span class="op">=</span> <span class="va">J</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
      <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="va">K</span>, prob <span class="op">=</span> <span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>This simulated data contains some species that have all <code>0</code> detections. In a real study, we would of course not have these entries. So the next step is to remove them from our data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Remove species that were never observed</span>
<span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="va">nd</span>,<span class="op">]</span></code></pre></div>
<div id="data-augmentation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-augmentation" class="anchor"></a>Data augmentation</h3>
<p>The current object <code>y</code> is what we would “observe” in a real study. No species with all <code>0</code> detection histories. But to account for imperfect detection, we need to add some all <code>0</code> detections back into the data. So we will create a matrix with all <code>0</code> detections for some large-ish number of species (we choose a number that we suspect is bigger than the true number of “missing” species, keeping in mind that the more we add, the longer it will take to fit our model). In this case, we’ll augment our data with 40 “potentially fake” species:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Add augmented individuals</span>
<span class="va">nAug</span> <span class="op">&lt;-</span> <span class="fl">40</span>
<span class="va">aug_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">nAug</span>, ncol <span class="op">=</span> <span class="va">J</span><span class="op">)</span>

<span class="va">y.aug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">aug_mat</span><span class="op">)</span></code></pre></div>
<p>In the model, we will try to determine which of these augment species are real (they were in our sample but we didn’t detect them) and which are fake.</p>
</div>
</div>
<div id="the-multi-species-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-multi-species-model" class="anchor"></a>The multi-species model</h2>
<p>Next, let’s write out the full model. At the top of the hierarchy, we need to decide which species are real and which are fake. We will define a random Bernoulli variable <span class="math inline">\(x_i\)</span> that is 1 for real specie and 0 for fake species with probability <span class="math inline">\(\omega\)</span> (or course for species that we detected, we know <span class="math inline">\(x_i\)</span> is 1)</p>
<p><span class="math display">\[\Large x_i \sim Bernoulli(\omega)\]</span></p>
<p>Next, we need to model the occupancy status of each species <span class="math inline">\(i\)</span> at each site <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[\Large z_{i,j} \sim Bernoulli(x_i \psi_i)\]</span></p>
<p>To treat species as random effects in this model, we will specify a distribution for the species-specific occupancy probabilities:</p>
<p><span class="math display">\[\Large logit(\psi_i) \sim normal(\mu_{\psi}, \tau_{\psi})\]</span></p>
<p>Next, we model the observations:</p>
<p><span class="math display">\[\Large y_{i,j} \sim binomial(z_{i,j}p_i, K)\]</span></p>
<p>where <span class="math inline">\(y_{i,j}\)</span> is the <strong>number</strong> of visits where species <span class="math inline">\(i\)</span> was detected at site <span class="math inline">\(j\)</span> (out of <span class="math inline">\(K\)</span>).</p>
<p>As for <span class="math inline">\(\psi_i\)</span>, we will treat <span class="math inline">\(p_i\)</span> as a species-specific random effect:</p>
<p><span class="math display">\[\Large logit(p_i) \sim normal(\mu_{p}, \tau_{p})\]</span></p>
<p>So this model has five parameters: <span class="math inline">\(\omega\)</span>, <span class="math inline">\(\mu_{\psi}\)</span>, <span class="math inline">\(\tau_{\psi}\)</span>, <span class="math inline">\(\mu_{p}\)</span>, and <span class="math inline">\(\tau_{p}\)</span>.</p>
<p>We can also define a derived variable to estimate richness:</p>
<p><span class="math display">\[\Large R = \sum_{i=1}^M x_i\]</span></p>
<p>Based on these details, let’s write the model in JAGS:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="st">"jags/Mult_spp_occ.jags"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"
model{
  # Priors

  # Likelihood
  for(i in 1:M){
   # Is species real or not?

    for(j in 1:J){
      # True occupancy at each site

      # Observed occupancy at each site
    }
  }

  # Richness

}
    "</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model fitting</h2>
<p>Now we’re ready to fit the model. As in the other occupancy models we’ve seen, initial values for <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> are important (remember that we need <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> for the full augmented data set):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Bundle data</span>
<span class="va">jags.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">y.aug</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">y.aug</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, K <span class="op">=</span> <span class="va">K</span>, y <span class="op">=</span> <span class="va">y.aug</span><span class="op">)</span>

<span class="co">## Initial values </span>
<span class="va">z.init</span> <span class="op">&lt;-</span> <span class="va">y.aug</span>
<span class="va">z.init</span><span class="op">[</span><span class="va">z.init</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">inits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, mu.psi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, mu.p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, 
                         sd.psi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, sd.p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
                         z <span class="op">=</span> <span class="va">z.init</span>,
                         x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">z.init</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>

<span class="co">## Parameters to monitor</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mu.psi"</span>, <span class="st">"mu.p"</span>, <span class="st">"sd.psi"</span>, <span class="st">"sd.p"</span>, <span class="st">"omega"</span>, <span class="st">"R"</span><span class="op">)</span>

<span class="co">## MCMC settings</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">ni</span> <span class="op">&lt;-</span> <span class="fl">50000</span>
<span class="va">nb</span> <span class="op">&lt;-</span> <span class="fl">5000</span>
<span class="va">nt</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jagsUI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jagsUI/man/jags.html">jags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">jags.data</span>, inits <span class="op">=</span> <span class="va">inits</span>, parameters.to.save <span class="op">=</span> <span class="va">params</span>, 
                    model.file <span class="op">=</span> <span class="st">"inst/jags/Mult_spp_occ.jags"</span>, 
                    n.chains <span class="op">=</span> <span class="va">nc</span>, n.iter <span class="op">=</span> <span class="va">ni</span>, n.burnin <span class="op">=</span> <span class="va">nb</span>, n.thin <span class="op">=</span> <span class="va">nt</span>, 
                    parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>As always, check for convergence:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu">jagsUI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jagsUI/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p>Assuming the model converged, how close was our estimated richness to the true value?</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
