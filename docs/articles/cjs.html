<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating apparent survival: Basic Cormack-Jolly-Seber models • WILD6900</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating apparent survival: Basic Cormack-Jolly-Seber models">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WILD6900</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2020.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lecture0/Lecture0.html">Lecture 0: Introduction to WILD6900</a>
    </li>
    <li>
      <a href="../articles/Lecture1/Lecture1.html">Lecture 1: Introduction to statistical inference in ecology</a>
    </li>
    <li>
      <a href="../articles/Lecture2/Lecture2.html">Lecture 2: Probability refresher (or introduction)</a>
    </li>
    <li>
      <a href="../articles/Lecture3/Lecture3.html">Lecture 3: Principles of Bayesian inference</a>
    </li>
    <li>
      <a href="../articles/Lecture4/Lecture4.html">Lecture 4: More about prior distributions</a>
    </li>
    <li>
      <a href="../articles/Lecture5/Lecture5.html">Lecture 5: Implementing Bayesian models: Introduction to MCMC samplers</a>
    </li>
    <li>
      <a href="../articles/Lecture6/Lecture6.html">Lecture 6: Introduction of Bayesian analysis using JAGS</a>
    </li>
    <li>
      <a href="../articles/Lecture7/Lecture7.html">Lecture 7: Generalized linear model review</a>
    </li>
    <li>
      <a href="../articles/Lecture8/Lecture8.html">Lecture 8: Introduction to hierarchical models</a>
    </li>
    <li>
      <a href="../articles/Lecture9/Lecture9.html">Lecture 9: Introduction to state-space models</a>
    </li>
    <li>
      <a href="../articles/Lecture10/Lecture10.html">Lecture 10: Estimating abundance: N-mixture models</a>
    </li>
    <li>
      <a href="../articles/Lecture11/Lecture11.html">Lecture 11: Estimating abundance: Occupancy modeling</a>
    </li>
    <li>
      <a href="../articles/Lecture12/Lecture12.html">Lecture 12: Estimating abundance: Closed-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture13/Lecture13.html">Lecture 13: Estimating survival: Open-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture14/Lecture14.html">Lecture 14: Estimating abundance and survival: Open-population capture-mark-recapture</a>
    </li>
    <li>
      <a href="../articles/Lecture15/Lecture15.html">Lecture 15: Multi-state models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/rmarkdown_intro.html">Introduction to R Markdown</a>
    </li>
    <li>
      <a href="../articles/priors.html">Creating prior distributions</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating regression data</a>
    </li>
    <li>
      <a href="../articles/metropolis.html">Metropolis sampler for linear regression model</a>
    </li>
    <li>
      <a href="../articles/poisson_glm.html">Poisson and binomial GLMs in JAGS</a>
    </li>
    <li>
      <a href="../articles/random_effects.html">Random effects ANCOVA in JAGS</a>
    </li>
    <li>
      <a href="../articles/state_space.html">Simple state-space models in JAGS</a>
    </li>
    <li>
      <a href="../articles/state_space2.html">Age-structured state-space models</a>
    </li>
    <li>
      <a href="../articles/n-mixture1.html">Introduction to N-mixture models</a>
    </li>
    <li>
      <a href="../articles/n-mixture2.html">Advanced N-mixture models: Zero-inflation and posterior predictive checks</a>
    </li>
    <li>
      <a href="../articles/multi_spp_occ.html">Estimating species richness using hierarchical occupancy models</a>
    </li>
    <li>
      <a href="../articles/cjs.html">Cormack-Jolly-Seber models</a>
    </li>
    <li>
      <a href="../articles/multi-state.html">Quantifying temporary emigration using multi-state models</a>
    </li>
    <li>
      <a href="../articles/multi-state2.html">Multi-state model for survival/transition probability of a perennial plant</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/homework.html">
    <span class="fas fa fas fa-pencil-square-o"></span>
     
    Assignments
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Estimating apparent survival: Basic Cormack-Jolly-Seber models</h1>
                        <h4 class="author">WILD6900</h4>
            
            <h4 class="date">2020-01-08</h4>
      
      
      <div class="hidden name"><code>cjs.Rmd</code></div>

    </div>

    
    
<p>In the lab, we’ll fit several versions of the Cormack-Jolly-Seber model to estimate apparent survival and detection probability from capture-recapture data.</p>
<div id="the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#the-data" class="anchor"></a>The data</h3>
<p>To learn more about the CJS model, we will use the famous dipper data set (Lebreton et al. 1992). The data comes from a population of European dippers in France and has been used in countless mark-recapture tutorials. Individual birds (n = 294) were captured and banded over 7 consecutive years during early summer along streams, providing 6 re-encounter occasions.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/d/d9/Cinclus_cinclus_V%C3%ADzirig%C3%B3.JPG" width="60%" style="display: block; margin: auto;"></p>
<p>We will treat the capture histories as a <span class="math inline">\(294 \times 7\)</span> matrix, which can be read into <code>R</code> with the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(WILD6900)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 3.5.2</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Warning: New theme missing the following elements: axis.ticks.length.x,</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; axis.ticks.length.x.top, axis.ticks.length.x.bottom, axis.ticks.length.y,</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; axis.ticks.length.y.left, axis.ticks.length.y.right</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"dipper"</span>)</a></code></pre></div>
</div>
<div id="the-basic-cjs-model-in-jags" class="section level3">
<h3 class="hasAnchor">
<a href="#the-basic-cjs-model-in-jags" class="anchor"></a>The basic CJS model in JAGS</h3>
<p>Next, let’s create a <code>.jags</code> file with the model code. To start, we’ll fit the most simple CJS model available - constant <span class="math inline">\(\phi\)</span> and <span class="math inline">\(p\)</span>. Remember that the state-space version of the CJS model can be written as:</p>
<div id="process-model-capture-occasion-1" class="section level4">
<h4 class="hasAnchor">
<a href="#process-model-capture-occasion-1" class="anchor"></a>Process model, capture occasion 1</h4>
<p><span class="math display">\[\large z_{i,f_1} = 1\]</span></p>
</div>
<div id="process-model-capture-occasion-2" class="section level4">
<h4 class="hasAnchor">
<a href="#process-model-capture-occasion-2" class="anchor"></a>Process model, capture occasion 2+</h4>
<p><span class="math display">\[\large z_{i,t} \sim Bernoulli(z_{i,t-1}\phi)\]</span></p>
</div>
<div id="observation-model" class="section level4">
<h4 class="hasAnchor">
<a href="#observation-model" class="anchor"></a>Observation model</h4>
<p><span class="math display">\[\large y_{i,t} \sim Bernoulli(z_{i,t}p)\]</span></p>
<p>Notice that to write this model in JAGS, we need to start the likelihood at the first capture occasion of each individual (we ignore all occasions prior to the first capture). In the model statement above, we call this occasion <span class="math inline">\(f_1\)</span>. In JAGS, we simply provide a vector of length <span class="math inline">\(n\)</span> called <span class="math inline">\(f1\)</span> as data and each element can take any integer value from 0-7.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sink">sink</a></span>(<span class="st">"jags/cjs.jags"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">model{</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  # Priors</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">   phi ~ dbeta(1, 1)</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">   p ~ dbeta(1, 1)</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">  # Likelihood</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">  for(i in 1:nInd){</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="st">   # Known to be alive on first occasion</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">   z[i, f1[i]] &lt;- 1</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">   for(t in (f1[i] + 1):nOcc){</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">    # State model</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">    z[i, t] ~ dbern(phi * z[i, t - 1])</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">    # Observation model</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="st">    y[i, t] ~ dbern(p * z[i, t])</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="st">   } # end t loop</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="st">  } # end i loop</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="st">} # end model</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="st">    "</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sink">sink</a></span>()</a></code></pre></div>
</div>
</div>
<div id="fitting-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-the-model" class="anchor"></a>Fitting the model</h3>
<p>Now we’re ready to fit the model. First, we need to create the vector <code>f1</code>. We’ll do this by using the <code>apply</code> function to determine, for each row, what is the first <span class="math inline">\(1\)</span> in the capture history:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">## The function min(which(x==1)) first returns which elements in the vector are 1 and then return the minimum of those values</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">## The `apply` function allows us to apply this function to each row (MARGIN = 1)</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">f1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(<span class="dt">X =</span> dipper, <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">## Bundle data</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">jags.data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> dipper, <span class="dt">nInd =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dipper)[<span class="dv">1</span>], <span class="dt">nOcc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dipper)[<span class="dv">2</span>], <span class="dt">f1 =</span> f1)</a></code></pre></div>
<p>As we saw for occupancy and closed-population CMR models, it’s important to provide good initial values for <code>z</code>. These initial values need to be stored in a matrix with the same dimensions as the capture history matrix. Also, we have to be sure <strong>not</strong> to provide initial values for any nodes that are deterministic (i.e., the first capture occasion, which we know is 1). So we’ll create a matrix that has <code>NA</code> for occasions 1-f1 and then 1’s after that:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">z.init &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">294</span>, <span class="dt">ncol =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(z.init)[<span class="dv">1</span>]){</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  z.init[i, f1[i]<span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(z.init)[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  z.init[i,f1[i]] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">### Initial values</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">inits &lt;-<span class="st"> </span><span class="cf">function</span>(){<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">1</span>), <span class="dt">p =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">                         <span class="dt">z =</span> z.init)}</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">### Parameters</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"phi"</span>, <span class="st">"p"</span>)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">### MCMC settings</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">nc &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">ni &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">nb &lt;-<span class="st"> </span><span class="dv">2500</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">nt &lt;-<span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<p>Now fit the model and look at the output:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">dipper1 &lt;-<span class="st"> </span>jagsUI<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jagsUI/topics/jags">jags</a></span>(<span class="dt">data =</span> jags.data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                        <span class="dt">model.file =</span> <span class="st">"jags/cjs.jags"</span>, <span class="dt">n.chains =</span> nc, <span class="dt">n.iter =</span> ni, <span class="dt">n.burnin =</span> nb, <span class="dt">n.thin =</span> nt,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                        <span class="dt">parallel =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">jagsUI<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jagsUI/topics/traceplot">traceplot</a></span>(dipper1)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(dipper1)</a></code></pre></div>
<pre><code>#&gt; 
#&gt; Processing function input....... 
#&gt; 
#&gt; Done. 
#&gt;  
#&gt; Beginning parallel processing using 3 cores. Console output will be suppressed.
#&gt; 
#&gt; Parallel processing completed.
#&gt; 
#&gt; Calculating statistics....... 
#&gt; 
#&gt; Done.</code></pre>
<p><img src="cjs_files/figure-html/unnamed-chunk-7-1.png" width="576"><img src="cjs_files/figure-html/unnamed-chunk-7-2.png" width="576"><img src="cjs_files/figure-html/unnamed-chunk-7-3.png" width="576"></p>
<pre><code>#&gt; JAGS output for model '/Users/clarkrushing/Desktop/WILD6900/inst/jags/cjs.jags', generated by jagsUI.
#&gt; Estimates based on 3 chains of 10000 iterations,
#&gt; adaptation = 100 iterations (sufficient),
#&gt; burn-in = 2500 iterations and thin rate = 1,
#&gt; yielding 22500 total samples from the joint posterior. 
#&gt; MCMC ran in parallel for 0.147 minutes at time 2020-01-08 09:32:36.
#&gt; 
#&gt;             mean     sd    2.5%     50%   97.5% overlap0 f  Rhat n.eff
#&gt; phi        0.562  0.025   0.511   0.562   0.610    FALSE 1 1.000  5498
#&gt; p          0.896  0.029   0.831   0.898   0.946    FALSE 1 1.001  7410
#&gt; deviance 164.554 28.187 113.580 162.706 225.271    FALSE 1 1.001  5311
#&gt; 
#&gt; Successful convergence based on Rhat values (all &lt; 1.1). 
#&gt; Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
#&gt; For each parameter, n.eff is a crude measure of effective sample size. 
#&gt; 
#&gt; overlap0 checks if 0 falls in the parameter's 95% credible interval.
#&gt; f is the proportion of the posterior with the same sign as the mean;
#&gt; i.e., our confidence that the parameter is positive or negative.
#&gt; 
#&gt; DIC info: (pD = var(deviance)/2) 
#&gt; pD = 397.1 and DIC = 561.7 
#&gt; DIC is an estimate of expected predictive error (lower is better).</code></pre>
<p>Looks good!</p>
</div>
<div id="modeling-group-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#modeling-group-effects" class="anchor"></a>Modeling group effects</h3>
<p>The original dipper data also includes information about the sex of each individual. Let’s use these data to test whether survival differs for males vs. females. First, read in the sex data:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"sex"</span>)</a></code></pre></div>
</div>
<div id="the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The model</h3>
<p>For the sex-specific survival model, we’ll simply estimate two separate survival probabilities and use a vector to index which survival probability applies to each individual:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sink">sink</a></span>(<span class="st">"jags/cjs_group.jags"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">model{</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  # Priors</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">   phi[1] ~ dbeta(1, 1)</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">   phi[2] ~ dbeta(1, 1)</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">   p ~ dbeta(1, 1)</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">  # Likelihood</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">  for(i in 1:nInd){</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="st">   # Known to be alive on first occasion</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">   z[i, f1[i]] &lt;- 1</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">   for(t in (f1[i] + 1):nOcc){</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">    # State model</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="st">    z[i, t] ~ dbern(phi[sex[i]] * z[i, t - 1])</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="st">    # Observation model</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="st">    y[i, t] ~ dbern(p * z[i, t])</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="st">   } # end t loop</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="st">  } # end i loop</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="st">  # Derived parameters</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="st">  delta.phi &lt;- phi[1] - phi[2]</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="st">} # end model</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="st">    "</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sink">sink</a></span>()</a></code></pre></div>
</div>
<div id="fitting-the-model-1" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-the-model-1" class="anchor"></a>Fitting the model</h3>
<p>No need to re-create the <code>f1</code> vector so all we need to do is add the vector with the sex information (though we do need to covert this to 1 (female) and 2 (male)):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">sex &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(sex))</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">## Bundle data</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">jags.data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> dipper, <span class="dt">nInd =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dipper)[<span class="dv">1</span>], <span class="dt">nOcc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dipper)[<span class="dv">2</span>], <span class="dt">f1 =</span> f1, <span class="dt">sex =</span> sex)</a></code></pre></div>
<p>As we saw for occupancy and closed-population CMR models, it’s important to provide good initial values for <code>z</code>. These initial values need to be stored in a matrix with the same dimensions as the capture history matrix. Also, we have to be sure <strong>not</strong> to provide initial values for any nodes that are deterministic (i.e., the first capture occasion, which we know is 1). So we’ll create a matrix that has <code>NA</code> for occasions 1-f1 and then 1’s after that:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">z.init &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">294</span>, <span class="dt">ncol =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(z.init)[<span class="dv">1</span>]){</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  z.init[i, f1[i]<span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(z.init)[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  z.init[i,f1[i]] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">### Initial values</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">inits &lt;-<span class="st"> </span><span class="cf">function</span>(){<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">2</span>), <span class="dt">p =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">                         <span class="dt">z =</span> z.init)}</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">### Parameters</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"phi"</span>, <span class="st">"p"</span>, <span class="st">"delta.phi"</span>)</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">### MCMC settings</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">nc &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">ni &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">nb &lt;-<span class="st"> </span><span class="dv">2500</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19">nt &lt;-<span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<p>Now fit the model and look at the output:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">dipper2 &lt;-<span class="st"> </span>jagsUI<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jagsUI/topics/jags">jags</a></span>(<span class="dt">data =</span> jags.data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params,</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">                        <span class="dt">model.file =</span> <span class="st">"jags/cjs_group.jags"</span>, <span class="dt">n.chains =</span> nc, <span class="dt">n.iter =</span> ni, <span class="dt">n.burnin =</span> nb, <span class="dt">n.thin =</span> nt,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                        <span class="dt">parallel =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">jagsUI<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jagsUI/topics/traceplot">traceplot</a></span>(dipper2)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(dipper2)</a></code></pre></div>
<pre><code>#&gt; 
#&gt; Processing function input....... 
#&gt; 
#&gt; Done. 
#&gt;  
#&gt; Beginning parallel processing using 3 cores. Console output will be suppressed.
#&gt; 
#&gt; Parallel processing completed.
#&gt; 
#&gt; Calculating statistics....... 
#&gt; 
#&gt; Done.</code></pre>
<p><img src="cjs_files/figure-html/unnamed-chunk-13-1.png" width="576"><img src="cjs_files/figure-html/unnamed-chunk-13-2.png" width="576"><img src="cjs_files/figure-html/unnamed-chunk-13-3.png" width="576"><img src="cjs_files/figure-html/unnamed-chunk-13-4.png" width="576"><img src="cjs_files/figure-html/unnamed-chunk-13-5.png" width="576"></p>
<pre><code>#&gt; JAGS output for model '/Users/clarkrushing/Desktop/WILD6900/inst/jags/cjs_group.jags', generated by jagsUI.
#&gt; Estimates based on 3 chains of 10000 iterations,
#&gt; adaptation = 100 iterations (sufficient),
#&gt; burn-in = 2500 iterations and thin rate = 1,
#&gt; yielding 22500 total samples from the joint posterior. 
#&gt; MCMC ran in parallel for 0.144 minutes at time 2020-01-08 09:32:46.
#&gt; 
#&gt;              mean     sd    2.5%     50%   97.5% overlap0     f  Rhat
#&gt; phi[1]      0.551  0.034   0.484   0.552   0.618    FALSE 1.000 1.000
#&gt; phi[2]      0.571  0.035   0.503   0.571   0.638    FALSE 1.000 1.000
#&gt; p           0.896  0.029   0.833   0.898   0.946    FALSE 1.000 1.001
#&gt; delta.phi  -0.019  0.048  -0.113  -0.020   0.075     TRUE 0.655 1.000
#&gt; deviance  164.105 28.046 113.330 162.679 223.758    FALSE 1.000 1.001
#&gt;           n.eff
#&gt; phi[1]     7015
#&gt; phi[2]     3631
#&gt; p          1787
#&gt; delta.phi 22500
#&gt; deviance   2269
#&gt; 
#&gt; Successful convergence based on Rhat values (all &lt; 1.1). 
#&gt; Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
#&gt; For each parameter, n.eff is a crude measure of effective sample size. 
#&gt; 
#&gt; overlap0 checks if 0 falls in the parameter's 95% credible interval.
#&gt; f is the proportion of the posterior with the same sign as the mean;
#&gt; i.e., our confidence that the parameter is positive or negative.
#&gt; 
#&gt; DIC info: (pD = var(deviance)/2) 
#&gt; pD = 393 and DIC = 557.1 
#&gt; DIC is an estimate of expected predictive error (lower is better).</code></pre>
<p>So we can see that there’s a 65% probability that male survival is higher than female survival. Not much evidence of a survival difference but see how simple it is to estimate derived parameters and their uncertainty?</p>
</div>
<div id="other-models" class="section level3">
<h3 class="hasAnchor">
<a href="#other-models" class="anchor"></a>Other models</h3>
<p>As we’ve seen throughout the semester, once we have the basic model structure in place, it’s relatively straightforward to add additional sources of complexity. For example, time effects, individual heterogeneity, covariates, trap responses, and interactions among these variables (though just remember that even though we can fit these models, that doesn’t necessarily mean that we can reliably estimate all of the parameters). Next week, we’ll explore a few of these more complex CJS models, as well as more efficient ways to parameterize the CJS model and ways to check for parameter identifiability. Stay tuned!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
