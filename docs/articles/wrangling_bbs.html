<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro to data wrangling • WILD6900</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intro to data wrangling">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WILD6900</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2019.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lecture0/Lecture0.html">Lecture 0: Introduction to WILD6900</a>
    </li>
    <li>
      <a href="../articles/Lecture1/Lecture1.html">Lecture 1: Introduction to statistical inference in ecology</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/rmarkdown_intro.html">Introduction to R Markdown</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/homework.html">
    <span class="fas fa fas fa-pencil-square-o"></span>
     
    Assignments
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Intro to data wrangling</h1>
            <h3 class="subtitle">Population growth of Eurasian collared-doves in Utah</h3>
                        <h4 class="author">WILD6900</h4>
            
            <h4 class="date">2019-01-04</h4>
      
      
      <div class="hidden name"><code>wrangling_bbs.Rmd</code></div>

    </div>

    
    
<p>In this lab, we will starting learning some useful tools and principles for preparing raw data for visualization and analysis. Many of the core principles of so called “data wrangling” are embodied by the <a href="https://www.tidyverse.org/packages/"><code>tidyverse</code></a>, a family of packages created to make tidying, manipulating, and visualizing data and model output more intuitive and consistent. Use of the tidyverse is somewhat <a href="http://varianceexplained.org/r/teach-tidyverse/">controversial</a> and it is worth noting that everything we will do in the lab can be done using base <code>R</code> or non-tidyverse packages. Nonetheless, I find the tidyverse useful <em>because</em> it is opinionated. The developers of the tidyverse have spent a great deal of time thinking about how data should be stored, manipulated, and visualized and they have created an entire ecosystem of functions built around these principles. Using the tidyverse isn’t so much about the tools themselves as it is about <strong>thinking about the structure and manipulation of data</strong>. For better or worse, focusing on consistent application of these principles is not something base <code>R</code> encourages.</p>
<div id="data-and-context" class="section level1">
<h1 class="hasAnchor">
<a href="#data-and-context" class="anchor"></a>Data and context</h1>
<div class="figure" style="text-align: center">
<img src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Eurasian_collared-dove_%28Streptopelia_decaocto%29.jpg" alt="Image courtesy of Charles J Sharp via Wikicommons (CC BY-SA 4.0)" width="400"><p class="caption">
Image courtesy of Charles J Sharp via Wikicommons (CC BY-SA 4.0)
</p>
</div>
<p>For this exercise, we will use data from the North American <a href="https://www.mbr-pwrc.usgs.gov/bbs/">Breeding Bird Survey</a> to examine the rapid population growth of Eurasian collared-doves (<em>Streptopelia decaocto</em>) in the state of Utah. Preparing the raw BBS data for analysis is challenging due the complexity and idiosyncrasies of data. For these reasons, preparing these data offers many good lessons for data manipulation in general. These data also lend themselves to a number of the models we will discuss this semester so this lab will form the basis for future labs.</p>
<p><img src="wrangling_bbs_files/figure-html/unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Eurasian collared-doves are an introduced species that, as you will soon see, have been rapidly expanding westward across the United States. In this lab, we will focus on cleaning and visualizing the raw data. In future labs, we will use these data and code to quantify population growth of this and other species.</p>
<div id="getting-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-the-data" class="anchor"></a>Getting the data</h2>
<p>First, let’s load the packages we will need for this exercise:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(WILD6900)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a></code></pre></div>
<p>Rather that starting from the survey-wide data, the <code>WILD6900</code> package includes data from just the BBS routes within the <a href="http://nabci-us.org/resources/bird-conservation-regions-map/">Bird Conservation Regions</a> that make up the state of Utah. You can access those data using the <code><a href="https://www.rdocumentation.org/packages/utils/topics/data">data()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"bbs_data"</span>)</a></code></pre></div>
</div>
<div id="data-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#data-structure" class="anchor"></a>Data structure</h2>
<p>Raw BBS data is divided between three separate files:</p>
<ol style="list-style-type: decimal">
<li>
<code>routes</code>: Geographic location and associated data for each route</li>
</ol>
<ul>
<li>1 row per route</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>
<code>weather</code>: Covariate values for each route in each year that it was monitored</li>
</ol>
<ul>
<li>1 row per route per year</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>
<code>counts</code>: species-specific counts for each route in each year</li>
</ol>
<ul>
<li><p>1 row per route per year</p></li>
<li><p>Note that the raw data does not include counts of 0!</p></li>
</ul>
<p>The example data we will used is included as a list with the three files as separate data frames. You can see the fields included in each data frame using:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(bbs_data<span class="op">$</span>routes)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(bbs_data<span class="op">$</span>weather)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(bbs_data<span class="op">$</span>counts[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">countrynum</th>
<th align="right">statenum</th>
<th align="right">Route</th>
<th align="right">Active</th>
<th align="right">Latitude</th>
<th align="right">Longitude</th>
<th align="right">BCR</th>
<th align="right">RouteTypeID</th>
<th align="right">routeID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">124</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">49.63</td>
<td align="right">-114.6</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">12404005</td>
</tr>
<tr class="even">
<td align="right">124</td>
<td align="right">4</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">50.48</td>
<td align="right">-114.4</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">12404010</td>
</tr>
<tr class="odd">
<td align="right">124</td>
<td align="right">4</td>
<td align="right">16</td>
<td align="right">0</td>
<td align="right">51.10</td>
<td align="right">-115.1</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">12404016</td>
</tr>
<tr class="even">
<td align="right">124</td>
<td align="right">4</td>
<td align="right">17</td>
<td align="right">1</td>
<td align="right">51.46</td>
<td align="right">-116.2</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">12404017</td>
</tr>
<tr class="odd">
<td align="right">124</td>
<td align="right">4</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">52.26</td>
<td align="right">-116.4</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">12404024</td>
</tr>
<tr class="even">
<td align="right">124</td>
<td align="right">4</td>
<td align="right">25</td>
<td align="right">1</td>
<td align="right">52.73</td>
<td align="right">-117.6</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">12404025</td>
</tr>
</tbody>
</table>
<table class="table">
<thead><tr class="header">
<th align="right">RPID</th>
<th align="right">Year</th>
<th align="right">Month</th>
<th align="right">Day</th>
<th align="right">ObsN</th>
<th align="left">StartTemp</th>
<th align="left">EndTemp</th>
<th align="left">StartWind</th>
<th align="left">EndWind</th>
<th align="left">StartSky</th>
<th align="left">EndSky</th>
<th align="right">StartTime</th>
<th align="right">EndTime</th>
<th align="left">Assistant</th>
<th align="right">RunType</th>
<th align="right">routeID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">101</td>
<td align="right">1973</td>
<td align="right">6</td>
<td align="right">23</td>
<td align="right">1090178</td>
<td align="left">50</td>
<td align="left">55</td>
<td align="left">5</td>
<td align="left">2</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="right">503</td>
<td align="right">852</td>
<td align="left">0</td>
<td align="right">0</td>
<td align="right">12404005</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">1975</td>
<td align="right">6</td>
<td align="right">21</td>
<td align="right">1090178</td>
<td align="left">50</td>
<td align="left">65</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="right">500</td>
<td align="right">930</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">12404005</td>
</tr>
<tr class="odd">
<td align="right">101</td>
<td align="right">1985</td>
<td align="right">6</td>
<td align="right">26</td>
<td align="right">1150442</td>
<td align="left">42</td>
<td align="left">59</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="right">500</td>
<td align="right">925</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">12404005</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">1986</td>
<td align="right">6</td>
<td align="right">22</td>
<td align="right">1150442</td>
<td align="left">46</td>
<td align="left">54</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="right">500</td>
<td align="right">933</td>
<td align="left">0</td>
<td align="right">0</td>
<td align="right">12404005</td>
</tr>
<tr class="odd">
<td align="right">101</td>
<td align="right">1987</td>
<td align="right">6</td>
<td align="right">28</td>
<td align="right">1150442</td>
<td align="left">53</td>
<td align="left">64</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="right">500</td>
<td align="right">938</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">12404005</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">1988</td>
<td align="right">6</td>
<td align="right">25</td>
<td align="right">1150442</td>
<td align="left">47</td>
<td align="left">62</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="right">500</td>
<td align="right">926</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">12404005</td>
</tr>
</tbody>
</table>
<table class="table">
<thead><tr class="header">
<th align="right">Year</th>
<th align="right">routeID</th>
<th align="right">10</th>
<th align="right">11</th>
<th align="right">12</th>
<th align="right">20</th>
<th align="right">30</th>
<th align="right">40</th>
<th align="right">60</th>
<th align="right">70</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1968</td>
<td align="right">12411004</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1968</td>
<td align="right">12411005</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">29</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="right">12411009</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1968</td>
<td align="right">12411018</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="right">12411020</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">1968</td>
<td align="right">12411023</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>For additional information about what each field represents, see the documentation page (<code><a href="../reference/bbs_data.html">?bbs_data</a></code>).</p>
</div>
<div id="subsetting-the-utah-routes" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-the-utah-routes" class="anchor"></a>Subsetting the Utah routes</h2>
<p>The <code>bbs_data</code> file contains counts from three BCRs (9, 10, and 16) but right now we only want data from Utah. There are many ways to subset data in <code>R</code> but for the sake of consistency, we will use the <code><a href="http://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function from the <code>dplyr</code> package.</p>
<hr>
<p><strong>NOTE</strong></p>
<p>There is also a <code><a href="http://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function in the <code>stats</code> package. Even though we loaded <code>dplyr</code>, it can sometimes be confusing to know which functions come from which packages (or to know which function <code>R</code> will default to using). For this reason, it’s good practice to get in the habit of using the <code>package::function()</code> syntax, as we will do below. Using this syntax makes explicit which package/function you intend to use which makes your code easier for other to understand and reduces the potential for errors. As a benefit, you can stop using <code><a href="https://www.rdocumentation.org/packages/base/topics/library">library(package)</a></code> at the beginning of each script.</p>
<hr>
<p>The BBS state number for Utah is 85 so we filter based on the <code>statenum</code> field in the <code>routes</code> data frame:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">ut_routes &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(bbs_data<span class="op">$</span>routes, statenum <span class="op">==</span><span class="st"> </span><span class="dv">85</span>)</a></code></pre></div>
<p>Unfortunately, neither the <code>weather</code> nor the <code>counts</code> data frames contain the <code>statenum</code> field. How do we subset the correct routes in this case? By using the one field common to all three data sets: <code>routeID</code>. So the challenge is to tell <code>R</code> to keep only the routes that are shared by the new <code>ut_routes</code> object and the <code>weather</code> and <code>counts</code> data frames. There are a few ways this could be done but one easy way is to filter using the <code>%in%</code> expression rather than <code>==</code> (<code>%in%</code> compares a vector <code>x</code> on the left-hand side to a second vector <code>y</code> on the right-hand side, returning <code>TRUE</code> for all values of <code>x</code> that are in <code>y</code> and <code>FALSE</code> otherwise):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## Subset weather and count using Utah routes</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">ut_weather &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(bbs_data<span class="op">$</span>weather, routeID <span class="op">%in%</span><span class="st"> </span>ut_routes<span class="op">$</span>routeID)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">ut_counts &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(bbs_data<span class="op">$</span>counts, routeID <span class="op">%in%</span><span class="st"> </span>ut_routes<span class="op">$</span>routeID)</a></code></pre></div>
<p>The <code>routeID</code> field is critical because it is the sole variable that links all three data frames together. It is common practice to divide up data into mutiple files so having an <code>ID</code> field of somesort that links observational units across all files is critical!</p>
</div>
<div id="subsetting-the-dove-data" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-the-dove-data" class="anchor"></a>Subsetting the dove data</h2>
<p>At present, <code>ut_counts</code> contains counts of all species. Each column (aside from <code>Year</code> and <code>routeID</code>) gives the number of individuals of each species counted on each route in each year. The column names refer to the numeric <code>aou</code> code used by BBS to identify species (Eurasion collared-dove is 22860). To get those data, we could use <code><a href="http://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">eucd_counts &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(ut_counts, Year, routeID, <span class="st">`</span><span class="dt">22860</span><span class="st">`</span>)</a></code></pre></div>
<p>However, there are a number of problems with the resulting data frame.</p>
<div id="what-is-tidy-data" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-tidy-data" class="anchor"></a>What is tidy data?</h3>
<p>The first problem with this data frame is that one of the column names is numeric. That’s not technically illegal (the data frame exists, after all), but it’s not great practice. At the very least, you have to put backticks around the column name to reference it (as we did above). Better to stick with non-numeric names, at least for the first character of a column name.</p>
<p>The bigger issue, however, is that this data frame isn’t <strong>tidy</strong>. What does it mean for data to be tidy? <a href="http://vita.had.co.nz/papers/tidy-data.html">Essentially</a>, “each variable is a column, each observation is a row.” In the <code>ut_counts</code> data frame, we have four main variables: year, routeID, the <code>aou</code> codes, and the counts themselves. Each observation is the count of a single species at a single route in a single year. As formatted, we have one variable (<code>aos</code> code) spread across mutiple columns and multiple observations per row. That format makes it hard to use the data. How would you plot the counts of a given species by year? How would you write a model for <code>counts ~ Year</code> by species? The short answer is you can’t without a lot of intermediate steps. In contrast, having tidy data makes these tasks much easier and consistent (as we will soon see).</p>
<p>So before we subset the dove data, let’s tidy the <code>ut_counts</code> data frame. We can do this with a single functions from the <code>tidyr</code> package:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">tidy_counts &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(ut_counts, <span class="dt">key =</span> <span class="st">"aou"</span>, <span class="dt">value =</span> <span class="st">"count"</span>, <span class="op">-</span>Year, <span class="op">-</span>routeID)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(tidy_counts)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Year</th>
<th align="right">routeID</th>
<th align="left">aou</th>
<th align="right">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1968</td>
<td align="right">84085006</td>
<td align="left">10</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1968</td>
<td align="right">84085007</td>
<td align="left">10</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="right">84085011</td>
<td align="left">10</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1968</td>
<td align="right">84085012</td>
<td align="left">10</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="right">84085015</td>
<td align="left">10</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1968</td>
<td align="right">84085020</td>
<td align="left">10</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>Gather turns a “wide” dataframe into a “long” data frame (awesome animations courtesy of <a href="https://github.com/gadenbuie/tidyexplain">Garrick Aden-Buie</a>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/include_graphics">include_graphics</a></span>(<span class="st">'images/tidyr-spread-gather.gif'</span>)</a></code></pre></div>
<p><img src="images/tidyr-spread-gather.gif" style="display: block; margin: auto;"></p>
<p>Now we can simply use <code><a href="http://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> to subset the dove counts:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">dove_counts &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(tidy_counts, aou <span class="op">==</span><span class="st"> </span><span class="dv">22860</span>)</a></code></pre></div>
</div>
</div>
</div>
<div id="filling-in-0-counts-using-joins" class="section level1">
<h1 class="hasAnchor">
<a href="#filling-in-0-counts-using-joins" class="anchor"></a>Filling in 0 counts using joins</h1>
<p>One of the main challenges to working with BBS data is that the raw counts don’t include 0’s. This is, if an observer didn’t see a Eurasian collared-dove, they don’t enter a 0, they enter nothing. That’s wouldn’t be a big issue except not every route is run in every year. So if we don’t have an entry for specific species/route/year combination in the <code>counts</code> data frame, we don’t immediately know if it’s because the count was a 0 (a <em>true 0</em>) or if it’s because the route wasn’t run that year (a missing value).</p>
<p>As always, there are multiple ways we could solve this problem. One thing to note is that the <code>weather</code> data frame contains covariate values for every run of every route. So if there are covariate values, we know the route was run. If not, we know it wasn’t. One efficient (though maybe not immediately intuitive) way to add the 0 counts is the <strong>join</strong> the two data frames in a way that fills in 0’s if there is a corresponding route/year combination in <code>weather</code> data frame and <code>NA</code> otherwise. Although not difficult to code, understanding how this works requires understanding the different types of <code>joins</code> available in the <code>tidyverse</code>.</p>
<div id="joins" class="section level2">
<h2 class="hasAnchor">
<a href="#joins" class="anchor"></a>Joins</h2>
<p>The <em>join</em> functions do exactly what they say - join two are more data frames. However, the manner in which they join and the output they produce varies depending on the type of join. In general, joins are divided into <a href="https://r4ds.had.co.nz/relational-data.html#mutating-joins">two categories</a>:</p>
<ol style="list-style-type: decimal">
<li>Mutating joins</li>
</ol>
<blockquote>
<p>A mutating join allows you to combine variables from two tables. It first matches observations by their keys, then copies across variables from one table to the other</p>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Filtering joins</li>
</ol>
<blockquote>
<p>Filtering joins match observations in the same way as mutating joins, but affect the observations, not the variables</p>
</blockquote>
<p>This difference will be more clear after looking at a few examples.</p>
<div id="mutating-joins" class="section level3">
<h3 class="hasAnchor">
<a href="#mutating-joins" class="anchor"></a>Mutating joins</h3>
<p>Mutating joins include <code><a href="http://dplyr.tidyverse.org/reference/join.html">inner_join()</a></code>, <code><a href="http://dplyr.tidyverse.org/reference/join.html">left_join()</a></code>, <code><a href="http://dplyr.tidyverse.org/reference/join.html">right_join()</a></code>, and <code><a href="http://dplyr.tidyverse.org/reference/join.html">full_join()</a></code> (note that all of these functions come from the <code>dplyr</code> package). Let’s start with <code><a href="http://dplyr.tidyverse.org/reference/join.html">full_join()</a></code>, which produces a new data frame that includes all rows and columns from the two original data frame (call them <code>x</code> and <code>y</code>):</p>
<p><img src="images/full-join.gif" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">(x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">id =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>)))</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">(y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">id =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>), <span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y4"</span>)))</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">full_join</a></span>(x, y)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">x1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">x2</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">x3</td>
</tr>
</tbody>
</table>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">y2</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">y4</td>
</tr>
</tbody>
</table>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">x</th>
<th align="left">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">x1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">x2</td>
<td align="left">y2</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">x3</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">NA</td>
<td align="left">y4</td>
</tr>
</tbody>
</table>
<p>Note that if there is not a matching values (<code>id = 3</code> and <code>id=4</code>), <code><a href="http://dplyr.tidyverse.org/reference/join.html">full_join()</a></code> returns NA</p>
<p>The remaining mutating joins do modified verions of what <code><a href="http://dplyr.tidyverse.org/reference/join.html">full_join()</a></code> does. <code><a href="http://dplyr.tidyverse.org/reference/join.html">left_join()</a></code> keeps all rows from <code>x</code> (or the “left” dataframe in the arguments) and all columns from both <code>x</code> and <code>y</code>. Rows in <code>y</code> that are not shared with <code>x</code> (<code>id = 4</code>) are dropped from the resulting data frame:</p>
<p><img src="images/left-join.gif" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(x, y)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">x</th>
<th align="left">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">x1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">x2</td>
<td align="left">y2</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">x3</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p><code><a href="http://dplyr.tidyverse.org/reference/join.html">right_join()</a></code> does the same thing but in reverse (so <code><a href="http://dplyr.tidyverse.org/reference/join.html">left_join(x,y)</a></code> produces the same output as <code><a href="http://dplyr.tidyverse.org/reference/join.html">right_join(y,x)</a></code>)</p>
<p><code><a href="http://dplyr.tidyverse.org/reference/join.html">inner_join()</a></code> is the most restrictive the the mutating joins. It returns only rows from <code>x</code> where there are matching values in <code>y</code>:</p>
<p><img src="images/inner-join.gif" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(x, y)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">x</th>
<th align="left">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">x1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">x2</td>
<td align="left">y2</td>
</tr>
</tbody>
</table>
<p>Note that all of these functions first look for columns with the same name (in this case <code>id</code>) and joins <em>by</em> that (or those) column(s).</p>
</div>
<div id="filtering-joins" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering-joins" class="anchor"></a>Filtering joins</h3>
<p>In the examples above, the resulting data frame contained all of the columns from both <code>x</code> and <code>y</code>. Filtering joins are different in that they only keep the columns from the first data frame. For example, <code><a href="http://dplyr.tidyverse.org/reference/join.html">semi_join()</a></code> returns all rows from <code>x</code> with matching values of <code>y</code> but only returns the original columns in <code>x</code>:</p>
<p><img src="images/semi-join.gif" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">semi_join</a></span>(x, y)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">x1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">x2</td>
</tr>
</tbody>
</table>
<p>This is useful for getting rid of rows in <code>x</code> that are not shared with <code>y</code> (similar to the way we used <code><a href="http://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to keep only rows we wanted in the BBS data frames).</p>
<p><code><a href="http://dplyr.tidyverse.org/reference/join.html">anti_join()</a></code> returns rows from <code>x</code> where there are <strong>not</strong> matching values in <code>y</code>:</p>
<p><img src="images/anti-join.gif" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">anti_join</a></span>(x, y)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">x</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">3</td>
<td align="left">x3</td>
</tr></tbody>
</table>
</div>
</div>
<div id="back-to-the-0-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#back-to-the-0-counts" class="anchor"></a>Back to the 0 counts</h2>
<p>So how can we use a join to add the 0 counts?</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#data-and-context">Data and context</a><ul class="nav nav-pills nav-stacked">
<li><a href="#getting-the-data">Getting the data</a></li>
      <li><a href="#data-structure">Data structure</a></li>
      <li><a href="#subsetting-the-utah-routes">Subsetting the Utah routes</a></li>
      <li><a href="#subsetting-the-dove-data">Subsetting the dove data</a></li>
      </ul>
</li>
      <li>
<a href="#filling-in-0-counts-using-joins">Filling in 0 counts using joins</a><ul class="nav nav-pills nav-stacked">
<li><a href="#joins">Joins</a></li>
      <li><a href="#back-to-the-0-counts">Back to the 0 counts</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
